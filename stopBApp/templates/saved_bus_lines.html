<!DOCTYPE html>
<html>
<head>
    <title>Saved Bus Lines</title>
</head>
<body>
    <h1>Saved Bus Lines</h1>
    <ul id="saved-bus-lines-list">
        {% for saved in saved_bus_lines %}
            <li id="saved-bus-line-{{ saved.bus_line.id }}">
                {{ saved.bus_line.name }}
                <button onclick="unsaveBusLine({{ saved.bus_line.id }})">Unsave</button>
            </li>
        {% endfor %}
    </ul>

    <h2>All Bus Lines</h2>
    <ul id="all-bus-lines-list">
        {% for bus_line in all_bus_lines %}
            <li id="all-bus-line-{{ bus_line.id }}">
                {{ bus_line.name }}
                <button onclick="saveBusLine({{ bus_line.id }})">Save</button>
            </li>
        {% endfor %}
    </ul>

    <script>
        function saveBusLine(busLineId) {
            fetch(`/save-bus-line/${busLineId}/`, {
                method: 'POST',
                headers: { 'X-CSRFToken': '{{ csrf_token }}' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert(data.message);
                    // Move the bus line from "All Bus Lines" to "Saved Bus Lines"
                    const busLineElement = document.getElementById(`all-bus-line-${busLineId}`);
                    if (busLineElement) {
                        busLineElement.remove();
                        const savedList = document.getElementById('saved-bus-lines-list');
                        const newSavedItem = document.createElement('li');
                        newSavedItem.id = `saved-bus-line-${busLineId}`;
                        newSavedItem.innerHTML = `
                            ${data.name}
                            <button onclick="unsaveBusLine(${busLineId})">Unsave</button>
                        `;
                        savedList.appendChild(newSavedItem);
                    }
                } else if (data.error) {
                    alert(data.error);
                }
            })
            .catch(error => console.error('Error:', error));
        }

        function unsaveBusLine(busLineId) {
            fetch(`/unsave-bus-line/${busLineId}/`, {
                method: 'POST',
                headers: { 'X-CSRFToken': '{{ csrf_token }}' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert(data.message);
                    // Move the bus line from "Saved Bus Lines" to "All Bus Lines"
                    const busLineElement = document.getElementById(`saved-bus-line-${busLineId}`);
                    if (busLineElement) {
                        busLineElement.remove();
                        const allList = document.getElementById('all-bus-lines-list');
                        const newAllItem = document.createElement('li');
                        newAllItem.id = `all-bus-line-${busLineId}`;
                        newAllItem.innerHTML = `
                            ${data.name}
                            <button onclick="saveBusLine(${busLineId})">Save</button>
                        `;
                        allList.appendChild(newAllItem);
                    }
                } else if (data.error) {
                    alert(data.error);
                }
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>